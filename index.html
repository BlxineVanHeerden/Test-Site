<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Invoice Generator</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  font-family:Inter,sans-serif;
  background:#f8fafc;
  padding:20px;
}
h1{text-align:center;color:#1e40af}
.section{
  background:white;
  padding:16px;
  border-radius:14px;
  margin-bottom:20px;
  box-shadow:0 6px 18px rgba(0,0,0,.06);
}
input,select,textarea,button{
  width:100%;
  padding:9px;
  margin-top:6px;
  border-radius:8px;
  border:1px solid #cbd5e1;
}
button{
  background:#1e40af;
  color:white;
  cursor:pointer;
  font-weight:600;
}
button:hover{background:#1e3a8a}
.row{display:flex;gap:12px;flex-wrap:wrap}
.row>div{flex:1;min-width:200px}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
}
th,td{
  padding:10px;
  border-bottom:1px solid #e5e7eb;
}
th{
  background:#e5e7eb;
}

.health-wrap{
  background:#e5e7eb;
  height:8px;
  border-radius:20px;
  overflow:hidden;
}
.health-bar{
  height:100%;
  width:0%;
  transition:.3s;
}

iframe{
  width:100%;
  height:650px;
  border-radius:14px;
  border:1px solid #e5e7eb;
}
</style>
</head>
<body>

<h1>Invoice Generator</h1>

<div class="section row">
  <div>
    <label>Document Type</label>
    <select id="docType">
      <option value="INV">Invoice</option>
      <option value="QUO">Quote</option>
      <option value="REC">Receipt</option>
    </select>
  </div>
  <div>
    <label>Invoice Number</label>
    <input id="invoiceNumber" readonly>
  </div>
</div>

<div class="section row">
  <div>
    <h3>Your Info</h3>
    <input id="fromName" placeholder="Business name">
    <input id="fromEmail" placeholder="Email">
    <input type="file" id="logoInput">
  </div>
  <div>
    <h3>Client Info</h3>
    <input id="toName" placeholder="Client name">
    <input id="toEmail" placeholder="Client email">
  </div>
</div>

<div class="section">
  <h3>Invoice Items</h3>
  <table id="itemsTable">
    <thead>
      <tr>
        <th>Item</th>
        <th>Category</th>
        <th>Qty</th>
        <th>Price</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="addItem()">Add Item</button>
</div>

<div class="section row">
  <div>
    <label>Currency</label>
    <select id="currency">
      <option value="$">USD ($)</option>
      <option value="€">EUR (€)</option>
      <option value="£">GBP (£)</option>
      <option value="R">ZAR (R)</option>
      <option value="¥">JPY (¥)</option>
    </select>
  </div>
  <div>
    <label>Tax %</label>
    <input type="number" id="tax" value="0">
  </div>
  <div>
    <label>Discount %</label>
    <input type="number" id="discount" value="0">
  </div>
</div>

<div class="section">
  <label>Client Note</label>
  <textarea id="note"></textarea>
</div>

<div class="section">
  <strong>Invoice Health</strong>
  <div class="health-wrap">
    <div id="healthBar" class="health-bar"></div>
  </div>
</div>

<div class="section row">
  <button onclick="previewInvoice()">Preview Invoice</button>
  <button onclick="downloadPDF()">Download PDF</button>
  <button onclick="saveInvoice()">Save Invoice</button>
  <button onclick="loadInvoice()">Load Invoice</button>
</div>

<h3>Preview</h3>
<iframe id="preview"></iframe>

<script>
const categories=[
"Professional Services","Consulting","Construction","Automotive",
"Healthcare","Education","Retail","Manufacturing","Hospitality",
"Logistics","Freelance","Agriculture","Media","Legal","Finance",
"Real Estate","IT & Technology","Cleaning","Security","Events","Miscellaneous"
];

let items=[];
let logoData=null;

// Invoice number updates with type
function generateInvoiceNumber(){
  const type=document.getElementById("docType").value;
  document.getElementById("invoiceNumber").value=
    `${type}-${Math.floor(100000+Math.random()*900000)}`;
}
generateInvoiceNumber();
docType.addEventListener("change",generateInvoiceNumber);

// Logo upload
logoInput.addEventListener("change",e=>{
  const reader=new FileReader();
  reader.onload=()=>logoData=reader.result;
  reader.readAsDataURL(e.target.files[0]);
});

function addItem(){
  const i=items.length;
  items.push({name:"",cat:"",qty:1,price:0});
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td><input oninput="items[${i}].name=this.value;updateHealth()"></td>
    <td>
      <select onchange="items[${i}].cat=this.value;updateHealth()">
        ${categories.map(c=>`<option>${c}</option>`).join("")}
      </select>
    </td>
    <td><input type="number" value="1" min="1"
      oninput="items[${i}].qty=this.value;updateHealth()"></td>
    <td><input type="number" value="0" min="0"
      oninput="items[${i}].price=this.value;updateHealth()"></td>
  `;
  document.querySelector("#itemsTable tbody").appendChild(tr);
}
addItem();

// Health bar
function updateHealth(){
  let score=0;
  ["fromName","toName","fromEmail","toEmail"].forEach(id=>{
    if(document.getElementById(id).value) score+=10;
  });
  items.forEach(i=>{
    if(i.name) score+=10;
    if(i.price>0) score+=10;
  });
  score=Math.min(score,100);
  const bar=document.getElementById("healthBar");
  bar.style.width=score+"%";
  bar.style.background=score<40?"#ef4444":score<70?"#facc15":"#22c55e";
}
document.addEventListener("input",updateHealth);

// Preview
function previewInvoice(){
  const cur=currency.value;
  const taxRate=Number(tax.value)||0;
  const discountRate=Number(discount.value)||0;

  let subtotal=0;
  const rows=items.map(i=>{
    const line=i.qty*i.price;
    subtotal+=line;
    return `
      <tr>
        <td>${i.name||"-"}</td>
        <td>${i.cat||"-"}</td>
        <td>${i.qty}</td>
        <td style="text-align:right">${cur}${line.toFixed(2)}</td>
      </tr>`;
  }).join("");

  const discountAmt=subtotal*(discountRate/100);
  const taxAmt=subtotal*(taxRate/100);
  const total=subtotal-discountAmt+taxAmt;

  preview.srcdoc=`
  <div style="font-family:Inter;padding:32px">
    ${logoData?`<img src="${logoData}" style="max-height:60px;margin-bottom:12px">`:""}
    <h2 style="color:#1e40af">${docType.selectedOptions[0].text}</h2>
    <p><strong>${fromName.value||"-"}</strong><br>Bill To: ${toName.value||"-"}</p>

    <table style="width:100%;border-collapse:collapse;margin-top:16px">
      <tr style="background:#e5e7eb">
        <th>Item</th><th>Category</th><th>Qty</th><th>Total</th>
      </tr>
      ${rows}
    </table>

    <div style="text-align:right;margin-top:16px">
      <p>Subtotal: ${cur}${subtotal.toFixed(2)}</p>
      <p>Discount: -${cur}${discountAmt.toFixed(2)}</p>
      <p>Tax: ${cur}${taxAmt.toFixed(2)}</p>
      <h3 style="color:#16a34a">Total: ${cur}${total.toFixed(2)}</h3>
    </div>

    ${note.value?`<p><strong>Note:</strong><br>${note.value}</p>`:""}
  </div>`;
}

// PDF export (basic but clean)
function downloadPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  pdf.text("Invoice Preview",20,20);
  pdf.text(preview.contentDocument.body.innerText,20,30);
  pdf.save("invoice.pdf");
}

// Save / Load
function saveInvoice(){
  localStorage.setItem("invoiceData",JSON.stringify({items,logoData}));
  alert("Invoice saved");
}
function loadInvoice(){
  const data=JSON.parse(localStorage.getItem("invoiceData"));
  if(!data)return alert("No saved invoice");
  items=data.items||[];
  logoData=data.logoData||null;
  document.querySelector("#itemsTable tbody").innerHTML="";
  items.forEach(()=>addItem());
  previewInvoice();
}
</script>

</body>
</html>
