<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Modern Invoice Generator</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    /* --- Global Styles --- */
    body {
      font-family: 'Inter', sans-serif;
      background: #f4f7fa;
      margin: 0;
      padding: 0 20px;
    }

    h1, h2, h3 {
      color: #222;
      margin-bottom: 10px;
    }

    .container {
      max-width: 1000px;
      margin: auto;
      background: #fff;
      padding: 20px 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      margin-top: 40px;
      margin-bottom: 40px;
    }

    input, select, textarea, button {
      font-family: 'Inter', sans-serif;
      font-size: 14px;
    }

    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin: 5px 0 15px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }

    button {
      padding: 10px 20px;
      background-color: #0077cc;
      color: #fff;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    button:hover {
      background-color: #005fa3;
    }

    .section {
      margin-bottom: 30px;
    }

    .flex-row {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }

    .flex-col {
      flex: 1;
      min-width: 200px;
    }

    label {
      font-weight: 600;
      display: block;
      margin-bottom: 5px;
    }

    /* --- Top selection --- */
    #documentType {
      margin-bottom: 25px;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-weight: 600;
      font-size: 16px;
    }

    /* --- Table Styles --- */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      border-radius: 8px;
      overflow: hidden;
    }

    table th, table td {
      padding: 12px;
      text-align: left;
    }

    table th {
      background-color: #0077cc;
      color: #fff;
      font-weight: 600;
    }

    table tbody tr:nth-child(even) {
      background-color: #f2f6fb;
    }

    table tbody tr:hover {
      background-color: #e0f0ff;
    }

    .totals {
      text-align: right;
      margin-top: 20px;
      font-size: 16px;
    }

    .totals span {
      display: inline-block;
      min-width: 120px;
      font-weight: 600;
    }

    iframe {
      width: 100%;
      height: 600px;
      border: 1px solid #ccc;
      margin-top: 20px;
      border-radius: 8px;
    }

    /* --- Responsive --- */
    @media(max-width: 700px){
      .flex-row {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">

    <h1>Modern Invoice Generator</h1>

    <!-- Document Type Selection -->
    <div class="section">
      <label for="documentType">Select Document Type</label>
      <select id="documentType">
        <option value="invoice">Invoice</option>
        <option value="quote">Quote</option>
        <option value="receipt">Receipt</option>
        <option value="proforma">Proforma Invoice</option>
      </select>
    </div>

    <!-- Invoice / Client Info -->
    <div class="section flex-row">
      <div class="flex-col">
        <h3>Your Info</h3>
        <input id="yourName" placeholder="Your Name / Business Name" />
        <input id="yourEmail" placeholder="Email" />
        <input id="yourPhone" placeholder="Phone (optional)" />
      </div>

      <div class="flex-col">
        <h3>Client Info</h3>
        <input id="clientName" placeholder="Client Name" />
        <input id="clientEmail" placeholder="Client Email" />
        <input id="clientPhone" placeholder="Client Phone (optional)" />
      </div>
    </div>

    <!-- Invoice Items Section (keep same as before) -->
    <div class="section">
      <h3>Invoice Items</h3>
      <table id="itemsTable">
        <thead>
          <tr>
            <th>Item</th>
            <th>Qty</th>
            <th>Price</th>
            <th>Total</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <!-- Dynamic items will be inserted here -->
        </tbody>
      </table>
      <button id="addItemBtn">Add Product</button>
    </div>

    <!-- Totals -->
    <div class="section totals">
      <div><span>Subtotal:</span> $<span id="subtotal">0.00</span></div>
      <div><span>Tax (%):</span> <input id="taxRate" type="number" value="0" style="width: 60px; display:inline-block;"> $<span id="taxAmount">0.00</span></div>
      <div><span>Grand Total:</span> $<span id="grandTotal">0.00</span></div>
    </div>

    <div class="section">
      <button id="previewBtn">Preview Document</button>
    </div>

    <h3>Preview</h3>
    <iframe id="invoicePreview"></iframe>
  </div>

  <script>
    // --- Item Management & Calculator ---
    const addItemBtn = document.getElementById('addItemBtn');
    const itemsTableBody = document.querySelector('#itemsTable tbody');
    const subtotalEl = document.getElementById('subtotal');
    const taxRateEl = document.getElementById('taxRate');
    const taxAmountEl = document.getElementById('taxAmount');
    const grandTotalEl = document.getElementById('grandTotal');

    let items = [];

    function renderItems() {
      itemsTableBody.innerHTML = '';
      items.forEach((item, index) => {
        const row = document.createElement('tr');

        row.innerHTML = `
          <td><input type="text" value="${item.name}" placeholder="Item Name" data-index="${index}" data-field="name"></td>
          <td><input type="number" value="${item.qty}" min="1" data-index="${index}" data-field="qty"></td>
          <td><input type="number" value="${item.price}" min="0" step="0.01" data-index="${index}" data-field="price"></td>
          <td>$${(item.qty * item.price).toFixed(2)}</td>
          <td><button onclick="removeItem(${index})" style="background:#ff4d4f;">Remove</button></td>
        `;
        itemsTableBody.appendChild(row);
      });
      calculateTotals();
      attachInputListeners();
    }

    function attachInputListeners() {
      const inputs = itemsTableBody.querySelectorAll('input');
      inputs.forEach(input => {
        input.oninput = (e) => {
          const index = e.target.dataset.index;
          const field = e.target.dataset.field;
          items[index][field] = field === 'name' ? e.target.value : parseFloat(e.target.value);
          renderItems();
        };
      });
    }

    function removeItem(index) {
      items.splice(index,1);
      renderItems();
    }

    addItemBtn.onclick = () => {
      items.push({name:'', qty:1, price:0});
      renderItems();
    };

    function calculateTotals() {
      const subtotal = items.reduce((sum,item)=>sum + (item.qty*item.price),0);
      const taxRate = parseFloat(taxRateEl.value) || 0;
      const taxAmount = subtotal * (taxRate/100);
      const grandTotal = subtotal + taxAmount;

      subtotalEl.innerText = subtotal.toFixed(2);
      taxAmountEl.innerText = taxAmount.toFixed(2);
      grandTotalEl.innerText = grandTotal.toFixed(2);
    }

    taxRateEl.oninput = calculateTotals;

    // --- Preview PDF (simplified for now) ---
    document.getElementById('previewBtn').onclick = () => {
      const docType = document.getElementById('documentType').value;
      const name = document.getElementById('yourName').value;
      const client = document.getElementById('clientName').value;

      const doc = new jspdf.jsPDF();
      doc.setFontSize(18);
      doc.text(`${docType.toUpperCase()}`, 14, 20);
      doc.setFontSize(12);
      doc.text(`From: ${name}`, 14, 30);
      doc.text(`To: ${client}`, 14, 40);

      let y = 50;
      items.forEach((item)=>{
        doc.text(`${item.name} x${item.qty} $${item.price} = $${(item.qty*item.price).toFixed(2)}`,14,y);
        y+=10;
      });

      doc.text(`Subtotal: $${subtotalEl.innerText}`,14,y+10);
      doc.text(`Tax: $${taxAmountEl.innerText}`,14,y+20);
      doc.text(`Grand Total: $${grandTotalEl.innerText}`,14,y+30);

      doc.output('dataurlnewwindow');
    }
  </script>
</body>
</html>
