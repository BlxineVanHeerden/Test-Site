<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Invoice Generator Pro</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  font-family:Inter,sans-serif;
  background:#f8fafc;
  padding:20px;
}
h1{text-align:center;color:#1e40af}
.section{
  background:white;
  padding:15px;
  border-radius:12px;
  margin-bottom:20px;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
}
input,select,textarea,button{
  width:100%;
  padding:8px;
  margin-top:6px;
  border-radius:6px;
  border:1px solid #cbd5e1;
}
button{
  background:#1e40af;
  color:white;
  cursor:pointer;
}
button:hover{background:#1e3a8a}
.row{display:flex;gap:10px;flex-wrap:wrap}
.row>div{flex:1;min-width:200px}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}
th,td{
  padding:10px;
  border-bottom:1px solid #e5e7eb;
}
th{background:#e5e7eb}

.health-bar{
  height:10px;
  background:#e5e7eb;
  border-radius:20px;
  overflow:hidden;
}
.health-fill{
  height:100%;
  width:0%;
  transition:.3s;
}
iframe{
  width:100%;
  height:650px;
  border-radius:12px;
  border:1px solid #e5e7eb;
}
.badge{
  display:inline-block;
  padding:4px 10px;
  border-radius:20px;
  font-size:12px;
  background:#dcfce7;
  color:#166534;
}
</style>
</head>
<body>

<h1>Invoice Generator Pro</h1>

<div class="section">
  <div class="row">
    <div>
      <label>Invoice Type</label>
      <select id="docType">
        <option>Invoice</option>
        <option>Quote</option>
        <option>Receipt</option>
      </select>
    </div>
    <div>
      <label>Invoice #</label>
      <input id="invoiceNumber" readonly>
    </div>
    <div>
      <label>Recurring</label>
      <select id="recurring">
        <option>No</option>
        <option>Monthly</option>
        <option>Yearly</option>
      </select>
    </div>
  </div>
</div>

<div class="section row">
  <div>
    <h3>Your Info</h3>
    <input id="fromName" placeholder="Business name">
    <input id="fromEmail" placeholder="Email">
    <input type="file" id="logo">
  </div>
  <div>
    <h3>Client Info</h3>
    <input id="toName" placeholder="Client name">
    <input id="toEmail" placeholder="Client email">
  </div>
</div>

<div class="section">
  <h3>Items</h3>
  <table id="items">
    <thead>
      <tr>
        <th>Item</th><th>Category</th><th>Qty</th><th>Price</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
  <button onclick="addItem()">Add Item</button>

  <input id="newCategory" placeholder="Add custom category (Premium)">
  <button onclick="addCategory()">Add Category</button>
</div>

<div class="section row">
  <div>
    <label>Currency</label>
    <select id="currency"></select>
  </div>
  <div>
    <label>Discount %</label>
    <input type="number" id="discount" value="0">
  </div>
  <div>
    <label>Tax %</label>
    <input type="number" id="tax" value="0">
  </div>
</div>

<div class="section">
  <label>Client Note</label>
  <textarea id="note"></textarea>
</div>

<div class="section">
  <strong>Invoice Health</strong>
  <div class="health-bar">
    <div id="healthFill" class="health-fill"></div>
  </div>
</div>

<div class="section row">
  <button onclick="preview()">Preview</button>
  <button onclick="downloadPDF()">Download PDF</button>
  <button onclick="saveInvoice()">Save Invoice</button>
  <button onclick="alert('Email feature ready for backend')">Email Invoice</button>
</div>

<iframe id="preview"></iframe>

<script>
const currencies={
 USD:"$",
 EUR:"€",
 GBP:"£",
 ZAR:"R",
 AUD:"A$",
 CAD:"C$"
};
const currencySel=document.getElementById("currency");
Object.keys(currencies).forEach(c=>{
  let o=document.createElement("option");
  o.value=c;o.textContent=`${c} (${currencies[c]})`;
  currencySel.appendChild(o);
});

let categories=["Services","Design","Consulting"];
let items=[];

function addItem(){
  let i=items.length;
  items.push({name:"",cat:"",qty:1,price:0});
  let tr=document.createElement("tr");
  tr.innerHTML=`
    <td><input oninput="items[${i}].name=this.value"></td>
    <td>
      <select onchange="items[${i}].cat=this.value">
        ${categories.map(c=>`<option>${c}</option>`).join("")}
      </select>
    </td>
    <td><input type="number" value="1" oninput="items[${i}].qty=this.value"></td>
    <td><input type="number" value="0" oninput="items[${i}].price=this.value"></td>
  `;
  document.querySelector("#items tbody").appendChild(tr);
  updateHealth();
}
addItem();

function addCategory(){
  let c=document.getElementById("newCategory").value;
  if(c){categories.push(c);alert("Category added");}
}

function updateHealth(){
  let filled=0;
  document.querySelectorAll("input,textarea").forEach(i=>{
    if(i.value)filled++;
  });
  let percent=Math.min(100,filled*6);
  let bar=document.getElementById("healthFill");
  bar.style.width=percent+"%";
  bar.style.background=percent<40?"#ef4444":percent<70?"#facc15":"#22c55e";
}
document.addEventListener("input",updateHealth);

function preview(){
  let cur=currencySel.value;
  let sym=currencies[cur];
  let subtotal=0;
  let rows=items.map(i=>{
    let t=i.qty*i.price;
    subtotal+=t;
    return `<tr><td>${i.name}</td><td>${i.cat}</td><td>${i.qty}</td><td>${sym}${t.toFixed(2)}</td></tr>`;
  }).join("");

  let disc=subtotal*(document.getElementById("discount").value/100);
  let tax=subtotal*(document.getElementById("tax").value/100);
  let total=subtotal-disc+tax;

  document.getElementById("preview").srcdoc=`
  <div style="font-family:Inter;padding:20px">
    <h2>${docType.value} <span class="badge">${recurring.value}</span></h2>
    <p><strong>${fromName.value}</strong> → ${toName.value}</p>
    <table>${rows}</table>
    <h3>Total: ${sym}${total.toFixed(2)}</h3>
    <p>${note.value}</p>
  </div>`;
}

function downloadPDF(){
  const {jsPDF}=window.jspdf;
  let pdf=new jsPDF();
  pdf.text("Invoice",20,20);
  pdf.save("invoice.pdf");
}

function saveInvoice(){
  localStorage.setItem("invoiceDraft",JSON.stringify(items));
  alert("Invoice saved locally");
}

document.getElementById("invoiceNumber").value=
  "INV-"+Math.floor(100000+Math.random()*900000);
</script>

</body>
</html>
