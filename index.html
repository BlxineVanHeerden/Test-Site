<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Invoice Tool | Free PDF Invoice & Quote Generator</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üßæ</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background: #f5f7fb; color: #1f2937; margin: 0; padding: 0; }
        .main-wrapper { display: flex; flex-direction: column; max-width: 1400px; margin: 0 auto; gap: 20px; padding: 15px; }

        @media(min-width: 1024px) {
            .main-wrapper { flex-direction: row; height: 95vh; padding: 25px; }
            .editor-pane { flex: 0 0 550px; overflow-y: auto; padding-right: 15px; height: 100%; scrollbar-width: thin; }
            .preview-pane { flex: 1; height: 100%; position: sticky; top: 0; }
        }

        .section { background: #fff; padding: 20px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); border: 1px solid #edf2f7; }
        h1 { font-size: 28px; font-weight: 800; margin-bottom: 5px; color: #111827; letter-spacing: -1px; }
        .sub-heading { font-size: 14px; color: #6366f1; font-weight: 600; margin-bottom: 25px; display: block; }
        h3 { font-size: 10px; text-transform: uppercase; color: #94a3b8; margin-bottom: 12px; letter-spacing: 1.5px; font-weight: 800; border-left: 3px solid #6366f1; padding-left: 8px; }

        label { font-size: 10px; font-weight: 700; color: #4b5563; text-transform: uppercase; display: flex; align-items: center; margin-bottom: 4px; }
        input, select, textarea { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #d1d5db; font-size: 13px; box-sizing: border-box; margin-bottom: 10px; font-family: inherit; }

        .plan-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .plan-box { border: 2px solid #e5e7eb; padding: 15px 10px; border-radius: 12px; text-align: center; cursor: pointer; transition: 0.3s ease; background: #fff; }
        .plan-box.active { border-color: #6366f1; background: #f5f3ff; }
        .plan-box b { display: block; font-size: 14px; margin-bottom: 5px; }
        .plan-box p { font-size: 9px; line-height: 1.3; color: #64748b; margin: 0; }

        .doc-type-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .doc-btn { padding: 10px; border: 1px solid #e5e7eb; border-radius: 8px; cursor: pointer; text-align: center; font-size: 11px; font-weight: 700; background: #fff; }
        .doc-btn.active { background: #6366f1; color: white; border-color: #6366f1; }

        iframe { width: 100%; height: 100%; border-radius: 16px; border: 1px solid #e5e7eb; background: #fff; }

        button { padding: 12px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; font-size: 12px; transition: 0.2s ease; }
        .btn-main { background: #111827; color: white; width: 48%; }
        .btn-locked { background: #cbd5e1 !important; cursor: not-allowed; color: #94a3b8; }
        .btn-save { background: #10b981; color: white; width: 48%; }
        .btn-clear { background: #f43f5e; color: white; width: 48%; }

        .remove-btn { background: none; color: #f43f5e; font-size: 16px; border: none; cursor: pointer; }
        .badge-pro { font-size: 8px; background: #fbbf24; color: #78350f; padding: 1px 4px; border-radius: 4px; margin-left: 4px; }

        .faq-box { display: none; background: #1e293b; color: #f8fafc; padding: 20px; border-radius: 12px; margin-bottom: 15px; font-size: 12px; line-height: 1.6; }
        .faq-box b { color: #818cf8; display: block; margin-top: 10px; }
    </style>
</head>
<body>

<div class="main-wrapper">
    <div class="editor-pane">
        <div style="display:flex; justify-content:space-between; align-items:flex-start;">
            <div>
                <h1>Smart Invoice Tool</h1>
                <span class="sub-heading">Professional Billing Suite</span>
            </div>
            <button onclick="toggleFAQ()" style="background:#e0e7ff; color:#4338ca; padding:8px 12px; font-size:10px;">Help & FAQ</button>
        </div>

        <div id="faqSection" class="faq-box">
            <h3 style="border-left-color:#818cf8; color:#fff">Support & FAQ</h3>
            <b>Is the preview free?</b>
            <span>Yes, the live renderer is 100% free. Professional features like logo removal and PDF export require a license.</span>
            <b>How do I save my business info?</b>
            <span>Fill out Section 4 and click "Save Business". Your data is stored locally so it's ready for your next session.</span>
            <b>24-Hour Pass</b>
            <span>Paid licenses are valid for 24 hours per session in this browser.</span>
        </div>

        <div class="section">
            <h3>1. Selection & Licensing</h3>
            <div class="plan-row">
                <div class="plan-box active" id="p-free" onclick="updatePlan('free')">
                    <b>Free</b><p>Watermarked Previews</p>
                </div>
                <div class="plan-box" id="p-basic">
                    <b>Basic</b><p>Clean PDF & CSV</p>
                    <div id="paypal-basic" style="margin-top:10px;"></div>
                </div>
                <div class="plan-box" id="p-pro">
                    <b>Pro</b><p>Branding & Logos</p>
                    <div id="paypal-pro" style="margin-top:10px;"></div>
                </div>
            </div>
        </div>

        <div class="section">
            <h3>2. Document Purpose</h3>
            <div class="doc-type-grid">
                <div id="btn-INVOICE" class="doc-btn active" onclick="setDocType('INVOICE', 'INV-')">Invoice</div>
                <div id="btn-QUOTE" class="doc-btn" onclick="setDocType('QUOTE', 'QT-')">Quote</div>
                <div id="btn-RECEIPT" class="doc-btn" onclick="setDocType('RECEIPT', 'RCP-')">Receipt</div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
                <div><label>Doc ID</label><input id="docNum" value="INV-101" oninput="debounceUpdate()"></div>
                <div><label>Project Term</label><input type="text" id="projectDate" placeholder="e.g. Feb 2026" oninput="debounceUpdate()"></div>
            </div>
        </div>

        <div class="section">
            <h3>3. Visual Identity</h3>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <div>
                    <label>Currency</label>
                    <select id="currency" onchange="updatePreview()">
                        <option value="$">USD ($)</option><option value="‚Ç¨">EUR (‚Ç¨)</option><option value="¬£">GBP (¬£)</option>
                        <option value="R">ZAR (R)</option><option value="¬•">JPY (¬•)</option><option value="‚Çπ">INR (‚Çπ)</option>
                        <option value="A$">AUD (A$)</option><option value="C$">CAD (C$)</option><option value="AED ">AED</option>
                    </select>
                </div>
                <div>
                    <label>Theme</label>
                    <select id="themeChoice" onchange="checkTheme(this)">
                        <option value="#3b82f6">Blue</option><option value="#111827">Dark</option>
                        <option value="#059669">Emerald (Pro)</option><option value="#dc2626">Crimson (Pro)</option>
                    </select>
                </div>
            </div>
            <label style="margin-top:10px;">Company Logo <span class="badge-pro">PRO</span></label>
            <input type="file" id="logoUpload" disabled onchange="handleLogo(this)">
        </div>

        <div class="section">
            <h3>4. Entity Details</h3>
            <label style="color:#6366f1">Issuer (You)</label>
            <input id="fromName" placeholder="Your Name" oninput="debounceUpdate()">
            <input id="fromCompany" placeholder="Your Company Name" oninput="debounceUpdate()">
            <input id="fromEmail" placeholder="Your Email" oninput="debounceUpdate()">
            <input id="fromVat" placeholder="Your VAT / Tax ID" oninput="debounceUpdate()">
            <textarea id="fromAddr" placeholder="Your Address" oninput="debounceUpdate()" style="height:45px;"></textarea>
            
            <label style="margin-top:10px; color:#10b981">Payment Instructions</label>
            <textarea id="paymentInfo" placeholder="Bank Details" oninput="debounceUpdate()" style="height:45px;"></textarea>

            <label style="margin-top:10px; color:#f59e0b">Notes & Terms</label>
            <textarea id="docNotes" placeholder="e.g. Net 30 days." oninput="debounceUpdate()" style="height:45px;"></textarea>

            <div style="display:flex; gap:10px;">
                <button class="btn-save" onclick="saveBusinessInfo()">üíæ Save Business</button>
                <button class="btn-clear" onclick="clearAllData()">üóëÔ∏è Clear All</button>
            </div>

            <label style="margin-top:20px; color:#6366f1">Recipient (Client)</label>
            <input id="toName" placeholder="Client Name" oninput="debounceUpdate()">
            <input id="toCompany" placeholder="Client Company" oninput="debounceUpdate()">
            <textarea id="toAddr" placeholder="Client Address" oninput="debounceUpdate()" style="height:45px;"></textarea>
        </div>

        <div class="section">
            <h3>5. Line Items</h3>
            <div id="itemsContainer"></div>
            <button onclick="addItem()" style="background:#f8fafc; color:#6366f1; width:100%; margin-top:10px; border:1px dashed #6366f1;">+ Add Item</button>
        </div>

        <div class="section">
            <h3>6. Financial Summary</h3>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <div><label>Tax %</label><input type="number" id="tax" value="0" oninput="debounceUpdate()"></div>
                <div><label>Late Fee <span class="badge-pro">PRO</span></label>
                    <select id="lateFee" disabled onchange="debounceUpdate()">
                        <option value="0">None</option>
                        <option value="5">5% Late Fee</option>
                        <option value="10">10% Late Fee</option>
                    </select>
                </div>
            </div>
            <div style="text-align:center; padding:15px; background:#f5f3ff; border-radius:10px; margin-top:10px;">
                <b id="totalNet" style="font-size:20px; color:#4338ca;">Balance Due: $0.00</b>
            </div>
        </div>

        <div style="margin-bottom: 80px;">
            <button id="pdfBtn" onclick="exportPDF()" class="btn-main btn-locked">Export PDF (License Required)</button>
        </div>
    </div>

    <div class="preview-pane">
        <iframe id="preview"></iframe>
    </div>
</div>

<script src="https://www.paypal.com/sdk/js?client-id=AX6SEngE_MrJHnM87AOoeOMYjECeo9Hu2QY3QMEzUKV97ahN1ttvJJndvcGhk9G27A8qEZGsGb95idNX&currency=USD" defer></script>

<script>
    let items = [];
    let selectedPlan = 'free';
    let currentType = 'INVOICE';
    let logoData = "";
    const subCats = ["Consulting", "Creative", "Software", "Marketing", "Legal", "Admin"];

    // --- LICENSE PERSISTENCE LOGIC ---
    function checkExistingLicense() {
        const savedLicense = localStorage.getItem('activePlan');
        const expiry = localStorage.getItem('planExpiry');
        if (savedLicense && expiry && Date.now() < parseInt(expiry)) {
            updatePlan(savedLicense, false); 
        }
    }

    function saveLicense(plan) {
        const twentyFourHours = 24 * 60 * 60 * 1000;
        localStorage.setItem('activePlan', plan);
        localStorage.setItem('planExpiry', (Date.now() + twentyFourHours).toString());
    }

    function toggleFAQ() {
        const f = document.getElementById('faqSection');
        f.style.display = f.style.display === 'block' ? 'none' : 'block';
    }

    function handleLogo(input) {
        const file = input.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) { logoData = e.target.result; updatePreview(); };
            reader.readAsDataURL(file);
        }
    }

    function saveBusinessInfo() {
        const info = {
            name: document.getElementById('fromName').value,
            company: document.getElementById('fromCompany').value,
            email: document.getElementById('fromEmail').value,
            vat: document.getElementById('fromVat').value,
            addr: document.getElementById('fromAddr').value,
            payment: document.getElementById('paymentInfo').value,
            notes: document.getElementById('docNotes').value
        };
        localStorage.setItem('issuerInfo', JSON.stringify(info));
        alert('Business info saved locally!');
    }

    function loadBusinessInfo() {
        const info = JSON.parse(localStorage.getItem('issuerInfo'));
        if(info) {
            document.getElementById('fromName').value = info.name || '';
            document.getElementById('fromCompany').value = info.company || '';
            document.getElementById('fromEmail').value = info.email || '';
            document.getElementById('fromVat').value = info.vat || '';
            document.getElementById('fromAddr').value = info.addr || '';
            document.getElementById('paymentInfo').value = info.payment || '';
            document.getElementById('docNotes').value = info.notes || '';
        }
    }

    function setDocType(type, prefix) {
        currentType = type;
        document.getElementById('docNum').value = prefix + Math.floor(100 + Math.random() * 900);
        document.querySelectorAll('.doc-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + type).classList.add('active');
        updatePreview();
    }

    function checkTheme(sel) {
        if ((sel.value === "#059669" || sel.value === "#dc2626") && selectedPlan !== 'pro') {
            alert("Upgrade to Pro to unlock premium themes!");
            sel.value = "#3b82f6";
        }
        updatePreview();
    }

    function addItem(n="", c="Consulting", q=1, p=0) {
        items.push({n, c, q, p}); renderItems(); updatePreview();
    }

    function renderItems() {
        const container = document.getElementById("itemsContainer"); container.innerHTML = "";
        items.forEach((item, idx) => {
            const div = document.createElement("div"); div.style = "display:grid; grid-template-columns: 2fr 1.5fr 0.6fr 1.2fr 30px; gap:5px; margin-bottom:8px;";
            div.innerHTML = `<input value="${item.n}" oninput="items[${idx}].n=this.value;updatePreview()">
                <select onchange="items[${idx}].c=this.value;updatePreview()">${subCats.map(cat => `<option value="${cat}" ${item.c===cat?'selected':''}>${cat}</option>`).join('')}</select>
                <input type="number" value="${item.q}" oninput="items[${idx}].q=Number(this.value);updatePreview()">
                <input type="number" value="${item.p}" oninput="items[${idx}].p=Number(this.value);updatePreview()">
                <button class="remove-btn" onclick="items.splice(${idx},1);renderItems();updatePreview()">‚úï</button>`;
            container.appendChild(div);
        });
    }

    function updatePreview() {
        const cur = document.getElementById("currency").value;
        const accent = document.getElementById("themeChoice").value;
        const pay = document.getElementById("paymentInfo").value;
        const notes = document.getElementById("docNotes").value;
        let sub = 0;
        const rows = items.map(i => {
            const l = i.q * i.p; sub += l;
            return `<tr><td style="padding:10px; border-bottom:1px solid #eee;"><b>${i.n}</b></td><td style="text-align:right;">${cur}${l.toLocaleString()}</td></tr>`;
        }).join("");
        const taxRate = Number(document.getElementById('tax').value) / 100;
        const lateRate = Number(document.getElementById('lateFee').value) / 100;
        const total = sub + (sub * taxRate) + (sub * lateRate);
        document.getElementById('totalNet').innerText = `Balance Due: ${cur}${total.toLocaleString()}`;
        const html = `<html><body style="font-family:'Inter', sans-serif; padding:40px; color:#1e293b;">
            <div style="display:flex; justify-content:space-between; border-bottom:5px solid ${accent}; padding-bottom:20px; margin-bottom:30px;">
                <div>
                    ${(selectedPlan === 'pro' && logoData) ? `<img src="${logoData}" style="max-height:60px;margin-bottom:10px;"><br>` : ''}
                    <h2 style="color:${accent}; margin:0;">${document.getElementById("fromCompany").value || 'YOUR BRAND'}</h2>
                    <p style="font-size:11px; margin:0;">${document.getElementById("fromName").value}<br>VAT: ${document.getElementById("fromVat").value}<br>${document.getElementById("fromAddr").value}</p>
                </div>
                <div style="text-align:right;">
                    <h1 style="margin:0; color:${accent};">${currentType}</h1>
                    <p>#${document.getElementById("docNum").value}</p>
                    <p style="font-size:12px;">${document.getElementById("projectDate").value}</p>
                </div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; margin-bottom:30px; font-size:11px;">
                <div><b>BILL TO:</b><br>${document.getElementById("toCompany").value}<br>${document.getElementById("toName").value}<br>${document.getElementById("toAddr").value}</div>
            </div>
            <table style="width:100%; border-collapse:collapse;">
                <thead><tr style="background:#f8fafc;"><th style="text-align:left; padding:10px;">Description</th><th style="text-align:right; padding:10px;">Total</th></tr></thead>
                <tbody>${rows}</tbody>
            </table>
            <div style="text-align:right; margin-top:30px; background:${accent}; color:white; padding:20px; border-radius:10px;">
                <small>BALANCE DUE</small><br><b style="font-size:28px;">${cur}${total.toLocaleString()}</b>
            </div>
            <div style="margin-top:40px; display:grid; grid-template-columns: 1fr 1fr; gap:20px; font-size:10px; border-top:1px solid #eee; padding-top:10px;">
                <div>${pay ? `<b>Payment:</b><br>${pay.replace(/\n/g, '<br>')}` : ''}</div>
                <div>${notes ? `<b>Notes:</b><br>${notes.replace(/\n/g, '<br>')}` : ''}</div>
            </div>
            ${selectedPlan === 'free' ? '<div style="margin-top:40px; text-align:center; color:#ccc; font-size:9px;">Smart Invoice Tool Free Preview</div>' : ''}
        </body></html>`;
        const d = document.getElementById('preview').contentWindow.document;
        d.open(); d.write(html); d.close();
    }

    function updatePlan(plan, isNewPurchase = true) {
        selectedPlan = plan;
        if (isNewPurchase && plan !== 'free') saveLicense(plan);
        document.querySelectorAll('.plan-box').forEach(b => b.classList.remove('active'));
        document.getElementById(`p-${plan}`).classList.add('active');
        const pdfBtn = document.getElementById('pdfBtn');
        if (plan !== 'free') {
            pdfBtn.className = "btn-main"; pdfBtn.innerText = "Export PDF";
            document.getElementById('lateFee').disabled = false;
        } else {
            pdfBtn.className = "btn-main btn-locked"; pdfBtn.innerText = "Export PDF (License Required)";
            document.getElementById('lateFee').disabled = true;
        }
        document.getElementById('logoUpload').disabled = (plan !== 'pro');
        updatePreview();
    }

    function exportPDF() {
        if (selectedPlan === 'free') return;
        const frame = document.getElementById('preview');
        frame.contentWindow.focus(); frame.contentWindow.print();
    }

    function createPayBtn(id, plan){ 
        if(typeof paypal !== 'undefined') {
            paypal.Buttons({ 
                style:{color:'blue', shape:'rect', height:25}, 
                onApprove: (data, actions) => {
                    return actions.order.capture().then(() => {
                        updatePlan(plan, true);
                        alert("Payment Successful! Features unlocked for 24 hours.");
                    });
                }
            }).render(`#${id}`); 
        } else { setTimeout(() => createPayBtn(id, plan), 1000); }
    }

    function debounceUpdate() { updatePreview(); }
    function clearAllData() { if(confirm("Reset all?")) { location.reload(); } }

    window.onload = () => { 
        loadBusinessInfo(); checkExistingLicense(); addItem(); updatePreview(); 
        createPayBtn("paypal-basic","basic"); createPayBtn("paypal-pro","pro"); 
    };
</script>
</body>
</html>
