<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Invoice Generator</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
/* --- Styles omitted for brevity, same as your previous version --- */
</style>
</head>
<body>

<h1>Smart Invoice Generator</h1>

<h2>Select a Plan</h2>
<div class="row" id="planContainer">
  <div class="plan-card" data-plan="free">
    <h3>Free</h3>
    <div class="plan-price">$0</div>
    <div class="plan-features">
      <div>Max 2 items</div>
      <div>Preview Only</div>
    </div>
  </div>
  <div class="plan-card" data-plan="basic">
    <h3>Basic</h3>
    <div class="plan-price">$5/mo</div>
    <div class="plan-features">
      <div>Max 10 items</div>
      <div>Download PDF</div>
      <div>Email notifications</div>
    </div>
  </div>
  <div class="plan-card" data-plan="pro">
    <h3>Pro</h3>
    <div class="plan-price">$10/mo</div>
    <div class="plan-features">
      <div>Unlimited items</div>
      <div>Custom branding</div>
      <div>Automated reminders</div>
    </div>
  </div>
</div>

<!-- Invoice Form (always visible) -->
<div class="section row" id="invoiceSection">
  <div>
    <label>Document Type</label>
    <select id="docType">
      <option value="INV">Invoice</option>
      <option value="QUO">Quote</option>
      <option value="REC">Receipt</option>
    </select>
  </div>
  <div>
    <label>Invoice Number</label>
    <div style="display:flex;gap:6px;">
      <input id="invoicePrefix" readonly style="width:60px;text-align:center;border-right:none;">
      <input id="invoiceNumber" style="flex:1;" placeholder="0001">
    </div>
  </div>
  <div>
    <label>Status</label>
    <select id="status">
      <option>Draft</option>
      <option>Sent</option>
      <option>Paid</option>
    </select>
  </div>
</div>

<div class="section row">
  <div>
    <h3>Your Info</h3>
    <input id="fromName" placeholder="Business name">
    <input id="fromEmail" placeholder="Email">
    <input id="fromPhone" placeholder="Contact number">
    <label>Logo (optional)</label>
    <input type="file" id="logoInput" accept="image/*">
  </div>
  <div>
    <h3>Client Info</h3>
    <input id="toName" placeholder="Client name">
    <input id="toEmail" placeholder="Client email">
    <input id="toPhone" placeholder="Client phone number">
  </div>
</div>

<div class="section">
  <h3>Invoice Items</h3>
  <table>
    <thead>
      <tr>
        <th>Item</th><th>Category</th><th>Qty</th><th>Price</th><th>Action</th>
      </tr>
    </thead>
    <tbody id="itemsBody"></tbody>
  </table>
  <button id="addItemBtn">Add Item</button>
</div>

<div class="section row">
  <div>
    <label>Currency</label>
    <select id="currency">
      <option value="$">USD ($)</option>
      <option value="€">EUR (€)</option>
      <option value="£">GBP (£)</option>
    </select>
  </div>
  <div>
    <label>Discount %</label>
    <input type="number" id="discount" value="0">
  </div>
  <div>
    <label>Tax %</label>
    <input type="number" id="tax" value="0">
  </div>
  <div>
    <label>Amount Paid</label>
    <input type="number" id="paid" value="0">
  </div>
</div>

<div class="section flex-row">
  <div class="flex-column" style="flex:1">
    <label>Payment Terms</label>
    <select id="terms">
      <option value="0">Due on receipt</option>
      <option value="7">Net 7</option>
      <option value="14">Net 14</option>
      <option value="30">Net 30</option>
    </select>
    <label>Due Date</label>
    <input type="date" id="dueDate">
  </div>
  <div style="flex:1">
    <label>Client Note</label>
    <textarea id="note"></textarea>
  </div>
</div>

<div class="button-group">
  <button onclick="updatePreview()">Preview Invoice</button>
  <button class="feature-btn" id="pdfBtn">Download PDF</button>
  <button class="feature-btn" id="sendBtn">Send Invoice</button>
  <button class="feature-btn" id="saveBtn">Save</button>
</div>

<h3>Invoice Preview</h3>
<iframe id="preview"></iframe>

<script>
const planButtons = document.querySelectorAll('.plan-card');
let selectedPlan = 'free';
planButtons.forEach(card=>{
  card.addEventListener('click',()=>{
    selectedPlan=card.getAttribute('data-plan');
    planButtons.forEach(c=>c.classList.remove('selected'));
    card.classList.add('selected');
    updateFeatureAccess();
  });
});

function updateFeatureAccess(){
  const pdfBtn=document.getElementById('pdfBtn');
  const sendBtn=document.getElementById('sendBtn');
  const saveBtn=document.getElementById('saveBtn');
  if(selectedPlan==='free'){
    pdfBtn.classList.remove('unlocked');
    sendBtn.classList.remove('unlocked');
    saveBtn.classList.remove('unlocked');
  } else if(selectedPlan==='basic'){
    pdfBtn.classList.add('unlocked');
    sendBtn.classList.remove('unlocked');
    saveBtn.classList.add('unlocked');
  } else if(selectedPlan==='pro'){
    pdfBtn.classList.add('unlocked');
    sendBtn.classList.add('unlocked');
    saveBtn.classList.add('unlocked');
  }
}

// --- Invoice logic ---
const categories=["Professional Services","Consulting","Retail","IT","Misc"];
const counters={INV:0,QUO:0,REC:0};
const docType=document.getElementById("docType");
const invoicePrefix=document.getElementById("invoicePrefix");
const invoiceNumber=document.getElementById("invoiceNumber");

function updateInvoiceNumber(){
  counters[docType.value]++;
  invoicePrefix.value=docType.value;
  invoiceNumber.value=String(counters[docType.value]).padStart(4,"0");
}
updateInvoiceNumber();
docType.addEventListener("change",updateInvoiceNumber);

let items=[];
const itemsBody=document.getElementById("itemsBody");

function addItem(){
  if(selectedPlan==='free' && items.length>=2) { alert("Free plan allows only 2 items"); return; }
  const index=items.length;
  items.push({name:"",cat:"",qty:1,price:0});

  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td><input oninput="items[${index}].name=this.value;updatePreview()"></td>
    <td><select onchange="items[${index}].cat=this.value;updatePreview()">
      ${categories.map(c=>`<option>${c}</option>`).join("")}
    </select></td>
    <td><input type="number" value="1" min="1" oninput="items[${index}].qty=Number(this.value);updatePreview()"></td>
    <td><input type="number" value="0" min="0" oninput="items[${index}].price=Number(this.value);updatePreview()"></td>
    <td><button class="remove-btn" onclick="items.splice(${index},1);this.parentElement.parentElement.remove();updatePreview()">Remove</button></td>
  `;
  itemsBody.appendChild(tr);
  updatePreview();
}

document.getElementById("addItemBtn").addEventListener("click",addItem);
addItem();

// --- Other inputs ---
["fromName","fromEmail","fromPhone","toName","toEmail","toPhone","discount","tax","paid","note","currency","status","invoiceNumber","dueDate"].forEach(id=>{
  document.getElementById(id).addEventListener("input",updatePreview);
});

// Logo upload
let logoData="";
document.getElementById("logoInput").addEventListener("change",e=>{
  const file=e.target.files[0];
  if(file){
    const reader=new FileReader();
    reader.onload=ev=>{ logoData=ev.target.result; updatePreview();}
    reader.readAsDataURL(file);
  }
});

// Terms & due date
const terms=document.getElementById("terms");
const dueDate=document.getElementById("dueDate");
terms.addEventListener("change",()=>{
  const d=new Date();
  d.setDate(d.getDate()+Number(terms.value));
  dueDate.value=d.toISOString().split("T")[0];
  updatePreview();
});
terms.dispatchEvent(new Event("change"));

// --- Preview ---
function updatePreview(){
  const cur=document.getElementById("currency").value;
  let subtotal=0;
  const rows=items.map(i=>{
    const t=i.qty*i.price;
    subtotal+=t;
    return `<tr>
      <td>${i.name||"-"}<br><small>${i.cat||""}</small></td>
      <td>${i.qty}</td>
      <td>${cur}${t.toFixed(2)}</td>
    </tr>`;
  }).join("");
  const disc=subtotal*(document.getElementById("discount").value/100);
  const tax=subtotal*(document.getElementById("tax").value/100);
  const total=subtotal-disc+tax-document.getElementById("paid").value*1;

  document.getElementById("preview").srcdoc=`
    <div style="font-family:Inter,sans-serif;padding:20px;background:#f9fafb">
      ${logoData?`<img src="${logoData}" style="max-height:60px;margin-bottom:12px;">`:''}
      <h2>${docType.value} #${invoiceNumber.value}</h2>
      <p>Status: ${document.getElementById("status").value}</p>
      <hr>
      <h3>From</h3>
      <p>${document.getElementById("fromName").value}<br>${document.getElementById("fromEmail").value}<br>${document.getElementById("fromPhone").value}</p>
      <h3>To</h3>
      <p>${document.getElementById("toName").value}<br>${document.getElementById("toEmail").value}<br>${document.getElementById("toPhone").value}</p>
      <h3>Items</h3>
      <table style="width:100%;border-collapse:collapse">
        <tr style="background:#3b82f6;color:#fff"><th>Item</th><th>Qty</th><th>Total</th></tr>
        ${rows}
      </table>
      <h3>Totals</h3>
      <p>Subtotal: ${cur}${subtotal.toFixed(2)}<br>
      Discount: ${cur}${disc.toFixed(2)}<br>
      Tax: ${cur}${tax.toFixed(2)}<br>
      <strong>Total Due: ${cur}${total.toFixed(2)}</strong></p>
      <p>Due Date: ${dueDate.value}</p>
      <p>Notes: ${document.getElementById("note").value}</p>
    </div>
  `;
}

// Initialize
document.querySelector('.plan-card[data-plan="free"]').click();
updatePreview();
</script>

</body>
</html>
