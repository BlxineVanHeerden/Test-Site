<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Invoice Generator - Plans</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body{font-family:Inter,sans-serif;background:#f5f7fb;padding:20px;color:#1f2937;}
h1{text-align:center;color:#111827;font-weight:700;margin-bottom:10px;}
.section{background:#fff;padding:20px;border-radius:16px;margin-bottom:24px;box-shadow:0 10px 25px rgba(0,0,0,.06);}
.plan-card{border:1px solid #d1d5db;border-radius:16px;padding:20px;flex:1;cursor:pointer;text-align:center;transition:all .3s;}
.plan-card.selected{border-color:#3b82f6;box-shadow:0 12px 28px rgba(59,130,246,0.2);}
.plan-price{font-size:22px;font-weight:700;margin:10px 0;background:linear-gradient(90deg,#3b82f6,#60a5fa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.plan-features{margin-top:12px;display:flex;flex-direction:column;gap:8px;}
.feature-btn{padding:6px 10px;border-radius:8px;font-size:13px;cursor:not-allowed;background:#e5e7eb;color:#374151;}
.feature-btn.unlocked{background:#3b82f6;color:#fff;cursor:pointer;}
button{font-weight:600;border:none;cursor:pointer;transition:all .2s;background:#3b82f6;color:#fff;padding:10px 12px;margin-top:10px;border-radius:8px;}
button:hover{background:#2563eb;}
.row{display:flex;gap:16px;flex-wrap:wrap;}
.row>div{flex:1;min-width:200px;}
table{width:100%;border-collapse:collapse;margin-top:12px;}
th,td{padding:12px;border-bottom:1px solid #e5e7eb;}
iframe{width:100%;height:720px;border-radius:16px;border:none;background:#f9fafb;}
.paypal-btn-container{margin-top:12px;}
</style>
</head>
<body>

<h1>Smart Invoice Generator</h1>

<h2>Select a Plan</h2>
<div class="row" id="planContainer">
  <div class="plan-card" data-plan="free">
    <h3>Free</h3>
    <div class="plan-price">$0</div>
    <div class="plan-features">
      <div>Max 2 items</div>
      <div>Invoice Preview Only</div>
    </div>
  </div>
  <div class="plan-card" data-plan="basic">
    <h3>Basic</h3>
    <div class="plan-price">$5/mo</div>
    <div class="plan-features">
      <div>Max 5 items</div>
      <div>Invoice PDF download</div>
      <div>Email notifications</div>
    </div>
    <div class="paypal-btn-container" id="paypal-basic"></div>
  </div>
  <div class="plan-card" data-plan="pro">
    <h3>Pro</h3>
    <div class="plan-price">$10/mo</div>
    <div class="plan-features">
      <div>Unlimited items</div>
      <div>Custom branding</div>
      <div>Automated reminders</div>
    </div>
    <div class="paypal-btn-container" id="paypal-pro"></div>
  </div>
</div>

<div class="section row" id="invoiceSection">
  <div>
    <label>Document Type</label>
    <select id="docType">
      <option value="INV">Invoice</option>
      <option value="QUO">Quote</option>
      <option value="REC">Receipt</option>
    </select>
  </div>
  <div>
    <label>Invoice Number</label>
    <div style="display:flex;gap:6px;">
      <input id="invoicePrefix" readonly style="width:60px;text-align:center;border-right:none;">
      <input id="invoiceNumber" style="flex:1;" placeholder="0001">
    </div>
  </div>
</div>

<div class="section">
  <h3>Invoice Items</h3>
  <table>
    <thead>
      <tr>
        <th>Item</th>
        <th>Category</th>
        <th>Qty</th>
        <th>Price</th>
      </tr>
    </thead>
    <tbody id="itemsBody"></tbody>
  </table>
  <button id="addItemBtn">Add Item</button>
</div>

<div class="button-group">
  <button class="feature-btn" id="pdfBtn">Download PDF</button>
  <button class="feature-btn" id="sendBtn">Send Invoice</button>
  <button class="feature-btn" id="saveBtn">Save</button>
</div>

<h3>Invoice Preview</h3>
<iframe id="preview"></iframe>

<script src="https://www.paypal.com/sdk/js?client-id=ASrqoC_iNPodEFNeqORNw&currency=USD"></script>

<script>
document.addEventListener("DOMContentLoaded", function(){
  let selectedPlan = 'free';
  const planCards = document.querySelectorAll('.plan-card');
  const pdfBtn = document.getElementById('pdfBtn');
  const sendBtn = document.getElementById('sendBtn');
  const saveBtn = document.getElementById('saveBtn');

  function updateFeatureAccess(){
    pdfBtn.classList.remove('unlocked');
    sendBtn.classList.remove('unlocked');
    saveBtn.classList.remove('unlocked');
    if(selectedPlan==='basic'){ pdfBtn.classList.add('unlocked'); saveBtn.classList.add('unlocked'); }
    if(selectedPlan==='pro'){ pdfBtn.classList.add('unlocked'); sendBtn.classList.add('unlocked'); saveBtn.classList.add('unlocked'); }
  }

  planCards.forEach(card=>{
    card.addEventListener('click', ()=>{
      selectedPlan = card.getAttribute('data-plan');
      planCards.forEach(c=>c.classList.remove('selected'));
      card.classList.add('selected');
      updateFeatureAccess();
    });
  });
  updateFeatureAccess();

  // --- Invoice ---
  const itemsBody=document.getElementById("itemsBody");
  let items=[{name:"Item 1",cat:"",qty:1,price:0}];
  function renderItems(){
    itemsBody.innerHTML="";
    items.forEach((i,index)=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`<td><input value="${i.name}" oninput="items[${index}].name=this.value;updatePreview();"></td>
      <td><input value="${i.cat}" oninput="items[${index}].cat=this.value;updatePreview();"></td>
      <td><input type="number" min="1" value="${i.qty}" oninput="items[${index}].qty=Number(this.value);updatePreview();"></td>
      <td><input type="number" min="0" value="${i.price}" oninput="items[${index}].price=Number(this.value);updatePreview();"></td>`;
      itemsBody.appendChild(tr);
    });
  }
  renderItems();
  document.getElementById("addItemBtn").addEventListener("click", ()=>{
    const maxItems = selectedPlan==='free'?2:selectedPlan==='basic'?5:999;
    if(items.length>=maxItems){ alert(`Max items for ${selectedPlan} plan is ${maxItems}`); return; }
    items.push({name:"",cat:"",qty:1,price:0}); renderItems(); updatePreview();
  });

  window.updatePreview=function(){
    const iframe = document.getElementById("preview");
    let total = 0;
    let rows = "";
    items.forEach(i=>{
      const line = i.qty*i.price; total+=line;
      rows+=`<tr><td>${i.name||"-"}</td><td>${i.qty}</td><td>${line.toFixed(2)}</td></tr>`;
    });
    const html = `<div style="padding:20px;font-family:Inter,sans-serif;">
    <h2>Invoice Preview</h2>
    <table border="1" cellpadding="6" cellspacing="0" style="width:100%;border-collapse:collapse;">
    <thead><tr><th>Item</th><th>Qty</th><th>Total</th></tr></thead><tbody>${rows}</tbody></table>
    <h3>Total: $${total.toFixed(2)}</h3></div>`;
    iframe.srcdoc = html;
  };
  updatePreview();

  // --- PayPal ---
  paypal.Buttons({
    createOrder: function(data, actions){
      let price = selectedPlan==='basic'?5:selectedPlan==='pro'?10:0;
      return actions.order.create({ purchase_units:[{ amount:{ value:price.toFixed(2) } }] });
    },
    onApprove: function(data, actions){
      return actions.order.capture().then(function(details){
        alert('Payment completed by ' + details.payer.name.given_name);
        if(selectedPlan==='basic'){ pdfBtn.classList.add('unlocked'); saveBtn.classList.add('unlocked'); }
        if(selectedPlan==='pro'){ pdfBtn.classList.add('unlocked'); sendBtn.classList.add('unlocked'); saveBtn.classList.add('unlocked'); }
      });
    }
  }).render('#paypal-basic');

  paypal.Buttons({
    createOrder: function(data, actions){
      let price = selectedPlan==='pro'?10:0;
      return actions.order.create({ purchase_units:[{ amount:{ value:price.toFixed(2) } }] });
    },
    onApprove: function(data, actions){
      return actions.order.capture().then(function(details){
        alert('Payment completed by ' + details.payer.name.given_name);
        pdfBtn.classList.add('unlocked'); sendBtn.classList.add('unlocked'); saveBtn.classList.add('unlocked');
      });
    }
  }).render('#paypal-pro');
});
</script>
</body>
</html>
